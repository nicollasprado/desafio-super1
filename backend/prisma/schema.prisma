generator client {
  provider     = "prisma-client"
  output       = "./generated"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                 String              @id @default(uuid())
  firstName          String              @map("first_name")
  lastName           String              @map("last_name")
  email              String              @unique
  password           String
  phone              String?             @unique
  providiedServices  ProviderService[]
  contractedServices ContractedService[]
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  deletedAt          DateTime?           @map("deleted_at")
  avatarUrl          String?             @map("avatar_url")

  @@map("users")
}

model Service {
  id               String            @id @default(uuid())
  name             String            @unique
  providerServices ProviderService[]

  @@map("service")
}

model ProviderService {
  id          String     @id @default(uuid())
  description String
  provider    User       @relation(fields: [providerId], references: [id], onDelete: Cascade)
  providerId  String     @map("provider_id")
  service     Service    @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  serviceId   String     @map("service_id")
  variants    Variant[]
  schedules   Schedule[]
  imagesUrls  String[]   @map("images_urls")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  deletedAt   DateTime?  @map("deleted_at")

  @@unique([providerId, serviceId])
  @@map("provider_service")
}

model Variant {
  id                 String              @id @default(uuid())
  name               String
  price              Int
  durationMinutes    Int                 @map("duration_minutes")
  providerService    ProviderService     @relation(fields: [providerServiceId], references: [id], onDelete: Cascade)
  providerServiceId  String              @map("provider_service_id")
  contractedServices ContractedService[]
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  deletedAt          DateTime?           @map("deleted_at")

  @@unique([providerServiceId, name])
  @@map("variant")
}

model Schedule {
  id                String          @id @default(uuid())
  weekday           Int            // 0 (Monday) to 6 (Sunday)
  start             DateTime
  end               DateTime
  providerService   ProviderService @relation(fields: [providerServiceId], references: [id], onDelete: Cascade)
  providerServiceId String          @map("provider_service_id")
  createdAt         DateTime        @default(now()) @map("created_at")
  updatedAt         DateTime        @updatedAt @map("updated_at")
  deletedAt         DateTime?       @map("deleted_at")

  @@unique([providerServiceId, weekday])
  @@map("schedule")
}

model ContractedService {
  id           String         @id @default(uuid())
  status       SERVICE_STATUS
  total_price  Int
  contractor   User           @relation(fields: [contractorId], references: [id], onDelete: Cascade)
  contractorId String         @map("contractor_id")
  start        DateTime
  end          DateTime
  variant      Variant        @relation(fields: [variantId], references: [id], onDelete: Cascade)
  variantId    String         @map("variant_id")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  deletedAt    DateTime?      @map("deleted_at")

  @@map("contracted_service")
}

enum SERVICE_STATUS {
  PAYMENT_PENDING
  WAITING_CONFIRMATION
  SCHEDULED
  ONGOING
  FINISHED
}
